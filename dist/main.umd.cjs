(function(t,e){typeof exports=="object"&&typeof module<"u"?e(exports):typeof define=="function"&&define.amd?define(["exports"],e):(t=typeof globalThis<"u"?globalThis:t||self,e(t.DD_RUM_PROFILER={}))})(this,function(exports){"use strict";const Interval=class w{constructor(e,i){this.low=e,this.high=i}clone(){return new w(this.low,this.high)}get max(){return this.clone()}less_than(e){return this.low<e.low||this.low==e.low&&this.high<e.high}equal_to(e){return this.low==e.low&&this.high==e.high}intersect(e){return!this.not_intersect(e)}not_intersect(e){return this.high<e.low||e.high<this.low}merge(e){return new w(this.low===void 0?e.low:Math.min(this.low,e.low),this.high===void 0?e.high:Math.max(this.high,e.high))}output(){return[this.low,this.high]}static comparable_max(e,i){return e.merge(i)}static comparable_less_than(e,i){return e<i}},RB_TREE_COLOR_RED=0,RB_TREE_COLOR_BLACK=1;class Node{constructor(e=void 0,i=void 0,n=null,r=null,o=null,s=RB_TREE_COLOR_BLACK){this.left=n,this.right=r,this.parent=o,this.color=s,this.item={key:e,value:i},e&&e instanceof Array&&e.length==2&&!Number.isNaN(e[0])&&!Number.isNaN(e[1])&&(this.item.key=new Interval(Math.min(e[0],e[1]),Math.max(e[0],e[1]))),this.max=this.item.key?this.item.key.max:void 0}isNil(){return this.item.key===void 0&&this.item.value===void 0&&this.left===null&&this.right===null&&this.color===RB_TREE_COLOR_BLACK}_value_less_than(e){return this.item.value&&e.item.value&&this.item.value.less_than?this.item.value.less_than(e.item.value):this.item.value<e.item.value}less_than(e){return this.item.value===this.item.key&&e.item.value===e.item.key?this.item.key.less_than(e.item.key):this.item.key.less_than(e.item.key)||this.item.key.equal_to(e.item.key)&&this._value_less_than(e)}_value_equal(e){return this.item.value&&e.item.value&&this.item.value.equal_to?this.item.value.equal_to(e.item.value):this.item.value==e.item.value}equal_to(e){return this.item.value===this.item.key&&e.item.value===e.item.key?this.item.key.equal_to(e.item.key):this.item.key.equal_to(e.item.key)&&this._value_equal(e)}intersect(e){return this.item.key.intersect(e.item.key)}copy_data(e){this.item.key=e.item.key,this.item.value=e.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){const e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.right.max)}if(this.left&&this.left.max){const e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.left.max)}}not_intersect_left_subtree(e){const i=this.item.key.constructor.comparable_less_than;let n=this.left.max.high!==void 0?this.left.max.high:this.left.max;return i(n,e.item.key.low)}not_intersect_right_subtree(e){const i=this.item.key.constructor.comparable_less_than;let n=this.right.max.low!==void 0?this.right.max.low:this.right.item.key.low;return i(e.item.key.high,n)}}class IntervalTree{constructor(){this.root=null,this.nil_node=new Node}get size(){let e=0;return this.tree_walk(this.root,()=>e++),e}get keys(){let e=[];return this.tree_walk(this.root,i=>e.push(i.item.key.output?i.item.key.output():i.item.key)),e}get values(){let e=[];return this.tree_walk(this.root,i=>e.push(i.item.value)),e}get items(){let e=[];return this.tree_walk(this.root,i=>e.push({key:i.item.key.output?i.item.key.output():i.item.key,value:i.item.value})),e}isEmpty(){return this.root==null||this.root==this.nil_node}clear(){this.root=null}insert(e,i=e){if(e===void 0)return;let n=new Node(e,i,this.nil_node,this.nil_node,null,RB_TREE_COLOR_RED);return this.tree_insert(n),this.recalc_max(n),n}exist(e,i=e){let n=new Node(e,i);return!!this.tree_search(this.root,n)}remove(e,i=e){let n=new Node(e,i),r=this.tree_search(this.root,n);return r&&this.tree_delete(r),r}search(e,i=(n,r)=>n===r?r.output():n){let n=new Node(e),r=[];return this.tree_search_interval(this.root,n,r),r.map(o=>i(o.item.value,o.item.key))}intersect_any(e){let i=new Node(e);return this.tree_find_any_interval(this.root,i)}forEach(e){this.tree_walk(this.root,i=>e(i.item.key,i.item.value))}map(e){const i=new IntervalTree;return this.tree_walk(this.root,n=>i.insert(n.item.key,e(n.item.value,n.item.key))),i}*iterate(e,i=(n,r)=>n===r?r.output():n){let n;for(e?n=this.tree_search_nearest_forward(this.root,new Node(e)):this.root&&(n=this.local_minimum(this.root));n;)yield i(n.item.value,n.item.key),n=this.tree_successor(n)}recalc_max(e){let i=e;for(;i.parent!=null;)i.parent.update_max(),i=i.parent}tree_insert(e){let i=this.root,n=null;if(this.root==null||this.root==this.nil_node)this.root=e;else{for(;i!=this.nil_node;)n=i,e.less_than(i)?i=i.left:i=i.right;e.parent=n,e.less_than(n)?n.left=e:n.right=e}this.insert_fixup(e)}insert_fixup(e){let i,n;for(i=e;i!=this.root&&i.parent.color==RB_TREE_COLOR_RED;)i.parent==i.parent.parent.left?(n=i.parent.parent.right,n.color==RB_TREE_COLOR_RED?(i.parent.color=RB_TREE_COLOR_BLACK,n.color=RB_TREE_COLOR_BLACK,i.parent.parent.color=RB_TREE_COLOR_RED,i=i.parent.parent):(i==i.parent.right&&(i=i.parent,this.rotate_left(i)),i.parent.color=RB_TREE_COLOR_BLACK,i.parent.parent.color=RB_TREE_COLOR_RED,this.rotate_right(i.parent.parent))):(n=i.parent.parent.left,n.color==RB_TREE_COLOR_RED?(i.parent.color=RB_TREE_COLOR_BLACK,n.color=RB_TREE_COLOR_BLACK,i.parent.parent.color=RB_TREE_COLOR_RED,i=i.parent.parent):(i==i.parent.left&&(i=i.parent,this.rotate_right(i)),i.parent.color=RB_TREE_COLOR_BLACK,i.parent.parent.color=RB_TREE_COLOR_RED,this.rotate_left(i.parent.parent)));this.root.color=RB_TREE_COLOR_BLACK}tree_delete(e){let i,n;e.left==this.nil_node||e.right==this.nil_node?i=e:i=this.tree_successor(e),i.left!=this.nil_node?n=i.left:n=i.right,n.parent=i.parent,i==this.root?this.root=n:(i==i.parent.left?i.parent.left=n:i.parent.right=n,i.parent.update_max()),this.recalc_max(n),i!=e&&(e.copy_data(i),e.update_max(),this.recalc_max(e)),i.color==RB_TREE_COLOR_BLACK&&this.delete_fixup(n)}delete_fixup(e){let i=e,n;for(;i!=this.root&&i.parent!=null&&i.color==RB_TREE_COLOR_BLACK;)i==i.parent.left?(n=i.parent.right,n.color==RB_TREE_COLOR_RED&&(n.color=RB_TREE_COLOR_BLACK,i.parent.color=RB_TREE_COLOR_RED,this.rotate_left(i.parent),n=i.parent.right),n.left.color==RB_TREE_COLOR_BLACK&&n.right.color==RB_TREE_COLOR_BLACK?(n.color=RB_TREE_COLOR_RED,i=i.parent):(n.right.color==RB_TREE_COLOR_BLACK&&(n.color=RB_TREE_COLOR_RED,n.left.color=RB_TREE_COLOR_BLACK,this.rotate_right(n),n=i.parent.right),n.color=i.parent.color,i.parent.color=RB_TREE_COLOR_BLACK,n.right.color=RB_TREE_COLOR_BLACK,this.rotate_left(i.parent),i=this.root)):(n=i.parent.left,n.color==RB_TREE_COLOR_RED&&(n.color=RB_TREE_COLOR_BLACK,i.parent.color=RB_TREE_COLOR_RED,this.rotate_right(i.parent),n=i.parent.left),n.left.color==RB_TREE_COLOR_BLACK&&n.right.color==RB_TREE_COLOR_BLACK?(n.color=RB_TREE_COLOR_RED,i=i.parent):(n.left.color==RB_TREE_COLOR_BLACK&&(n.color=RB_TREE_COLOR_RED,n.right.color=RB_TREE_COLOR_BLACK,this.rotate_left(n),n=i.parent.left),n.color=i.parent.color,i.parent.color=RB_TREE_COLOR_BLACK,n.left.color=RB_TREE_COLOR_BLACK,this.rotate_right(i.parent),i=this.root));i.color=RB_TREE_COLOR_BLACK}tree_search(e,i){if(!(e==null||e==this.nil_node))return i.equal_to(e)?e:i.less_than(e)?this.tree_search(e.left,i):this.tree_search(e.right,i)}tree_search_nearest_forward(e,i){let n,r=e;for(;r&&r!=this.nil_node;)r.less_than(i)?r.intersect(i)?(n=r,r=r.left):r=r.right:((!n||r.less_than(n))&&(n=r),r=r.left);return n||null}tree_search_interval(e,i,n){e!=null&&e!=this.nil_node&&(e.left!=this.nil_node&&!e.not_intersect_left_subtree(i)&&this.tree_search_interval(e.left,i,n),e.intersect(i)&&n.push(e),e.right!=this.nil_node&&!e.not_intersect_right_subtree(i)&&this.tree_search_interval(e.right,i,n))}tree_find_any_interval(e,i){let n=!1;return e!=null&&e!=this.nil_node&&(e.left!=this.nil_node&&!e.not_intersect_left_subtree(i)&&(n=this.tree_find_any_interval(e.left,i)),n||(n=e.intersect(i)),!n&&e.right!=this.nil_node&&!e.not_intersect_right_subtree(i)&&(n=this.tree_find_any_interval(e.right,i))),n}local_minimum(e){let i=e;for(;i.left!=null&&i.left!=this.nil_node;)i=i.left;return i}local_maximum(e){let i=e;for(;i.right!=null&&i.right!=this.nil_node;)i=i.right;return i}tree_successor(e){let i,n,r;if(e.right!=this.nil_node)i=this.local_minimum(e.right);else{for(n=e,r=e.parent;r!=null&&r.right==n;)n=r,r=r.parent;i=r}return i}rotate_left(e){let i=e.right;e.right=i.left,i.left!=this.nil_node&&(i.left.parent=e),i.parent=e.parent,e==this.root?this.root=i:e==e.parent.left?e.parent.left=i:e.parent.right=i,i.left=e,e.parent=i,e!=null&&e!=this.nil_node&&e.update_max(),i=e.parent,i!=null&&i!=this.nil_node&&i.update_max()}rotate_right(e){let i=e.left;e.left=i.right,i.right!=this.nil_node&&(i.right.parent=e),i.parent=e.parent,e==this.root?this.root=i:e==e.parent.left?e.parent.left=i:e.parent.right=i,i.right=e,e.parent=i,e!=null&&e!=this.nil_node&&e.update_max(),i=e.parent,i!=null&&i!=this.nil_node&&i.update_max()}tree_walk(e,i){e!=null&&e!=this.nil_node&&(this.tree_walk(e.left,i),i(e),this.tree_walk(e.right,i))}testRedBlackProperty(){let e=!0;return this.tree_walk(this.root,function(i){i.color==RB_TREE_COLOR_RED&&(i.left.color==RB_TREE_COLOR_BLACK&&i.right.color==RB_TREE_COLOR_BLACK||(e=!1))}),e}testBlackHeightProperty(e){let i=0,n=0,r=0;if(e.color==RB_TREE_COLOR_BLACK&&i++,e.left!=this.nil_node?n=this.testBlackHeightProperty(e.left):n=1,e.right!=this.nil_node?r=this.testBlackHeightProperty(e.right):r=1,n!=r)throw new Error("Red-black height property violated");return i+=n,i}}class Timeline{constructor(e,i,n){this.getStartTime=i,this.getEndTime=n,this.tree=new IntervalTree;for(const r of e)this.tree.insert([this.getStartTime(r),this.getEndTime(r)],r)}get(e){return this.tree.search([e,e])}}class EventsTimeline extends Timeline{constructor(e){super(e.events,i=>i.processingStart,i=>i.processingEnd)}}class InteractionsTimeline extends Timeline{constructor(e){super(e.events.filter(i=>i.interactionId!==void 0).filter((i,n,r)=>n===r.findIndex(o=>o.interactionId===i.interactionId)),i=>i.startTime,i=>i.startTime+i.duration)}}class LongTasksTimeline extends Timeline{constructor(e){super(e.longTasks,i=>i.startTime,i=>i.startTime+i.duration)}}class MeasuresTimeline extends Timeline{constructor(e){super(e.measures,i=>i.startTime,i=>i.startTime+i.duration)}}class NavigationTimeline extends Timeline{constructor(e){super(e.navigation,i=>i.startTime,i=>i.endTime)}}class LruCache{constructor(e){this.values=new Map,this.maxEntries=e}get(e){let i;return this.values.has(e)&&(i=this.values.get(e),this.values.delete(e),this.values.set(e,i)),i}set(e,i){if(this.values.size>=this.maxEntries){const n=this.values.keys().next().value;this.values.delete(n)}this.values.set(e,i)}}const registry=new LruCache(2400);function getLongTaskId(t){const e=registry.get(t)||generateUUID();return registry.set(t,e),e}function generateUUID(t){return t?(parseInt(t,10)^Math.random()*16>>parseInt(t,10)/4).toString(16):`10000000-1000-4000-8000-${1e11}`.replace(/[018]/g,generateUUID)}function getRum(){return window.DD_RUM}class SamplesView{constructor(e){this.trace=e}getStartTime(e){return e===0?this.trace.samples[e].timestamp-this.trace.sampleInterval/2:(this.trace.samples[e-1].timestamp+this.trace.samples[e].timestamp)/2}getMiddleTime(e){return this.trace.samples[e].timestamp}getEndTime(e){return e===this.trace.samples.length-1?this.trace.samples[e].timestamp+this.trace.sampleInterval/2:(this.trace.samples[e].timestamp+this.trace.samples[e+1].timestamp)/2}}class StringsTable{constructor(){this.stringsMap=new Map([["",0]])}dedup(e){if(this.stringsMap.has(e))return this.stringsMap.get(e);{const i=this.stringsMap.size;return this.stringsMap.set(e,i),i}}[Symbol.iterator](){return this.stringsMap.keys()}}let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let t=0;t<256;++t)byteToHex.push((t+256).toString(16).slice(1));function unsafeStringify(t,e=0){return byteToHex[t[e+0]]+byteToHex[t[e+1]]+byteToHex[t[e+2]]+byteToHex[t[e+3]]+"-"+byteToHex[t[e+4]]+byteToHex[t[e+5]]+"-"+byteToHex[t[e+6]]+byteToHex[t[e+7]]+"-"+byteToHex[t[e+8]]+byteToHex[t[e+9]]+"-"+byteToHex[t[e+10]]+byteToHex[t[e+11]]+byteToHex[t[e+12]]+byteToHex[t[e+13]]+byteToHex[t[e+14]]+byteToHex[t[e+15]]}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(t,e,i){if(native.randomUUID&&!e&&!t)return native.randomUUID();t=t||{};const n=t.random||(t.rng||rng)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){i=i||0;for(let r=0;r<16;++r)e[i+r]=n[r];return e}return unsafeStringify(n)}function buildEndpoint(t,e,i,n,r){const o=`/api/v2/${i}`,s=buildEndpointHost(t),u=buildEndpointParameters(e,n,r);return`https://${s}${o}?${u}`}function buildEndpointHost(t){const e=t.split("."),i=e.pop();return`browser-intake-${e.join("-")}.${i}`}function buildEndpointParameters(t,e,i){const n=[`api:${i}`].concat(e);return["ddsource=browser",`ddtags=${encodeURIComponent(n.join(","))}`,`dd-api-key=${t}`,"dd-evp-origin=browser",`dd-request-id=${v4()}`].join("&")}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},indexMinimal={},minimal$1={},aspromise=asPromise;function asPromise(t,e){for(var i=new Array(arguments.length-1),n=0,r=2,o=!0;r<arguments.length;)i[n++]=arguments[r++];return new Promise(function(u,l){i[n]=function(f){if(o)if(o=!1,f)l(f);else{for(var h=new Array(arguments.length-1),d=0;d<h.length;)h[d++]=arguments[d];u.apply(null,h)}};try{t.apply(e||null,i)}catch(a){o&&(o=!1,l(a))}})}var base64$1={};(function(t){var e=t;e.length=function(u){var l=u.length;if(!l)return 0;for(var a=0;--l%4>1&&u.charAt(l)==="=";)++a;return Math.ceil(u.length*3)/4-a};for(var i=new Array(64),n=new Array(123),r=0;r<64;)n[i[r]=r<26?r+65:r<52?r+71:r<62?r-4:r-59|43]=r++;e.encode=function(u,l,a){for(var f=null,h=[],d=0,_=0,p;l<a;){var c=u[l++];switch(_){case 0:h[d++]=i[c>>2],p=(c&3)<<4,_=1;break;case 1:h[d++]=i[p|c>>4],p=(c&15)<<2,_=2;break;case 2:h[d++]=i[p|c>>6],h[d++]=i[c&63],_=0;break}d>8191&&((f||(f=[])).push(String.fromCharCode.apply(String,h)),d=0)}return _&&(h[d++]=i[p],h[d++]=61,_===1&&(h[d++]=61)),f?(d&&f.push(String.fromCharCode.apply(String,h.slice(0,d))),f.join("")):String.fromCharCode.apply(String,h.slice(0,d))};var o="invalid encoding";e.decode=function(u,l,a){for(var f=a,h=0,d,_=0;_<u.length;){var p=u.charCodeAt(_++);if(p===61&&h>1)break;if((p=n[p])===void 0)throw Error(o);switch(h){case 0:d=p,h=1;break;case 1:l[a++]=d<<2|(p&48)>>4,d=p,h=2;break;case 2:l[a++]=(d&15)<<4|(p&60)>>2,d=p,h=3;break;case 3:l[a++]=(d&3)<<6|p,h=0;break}}if(h===1)throw Error(o);return a-f},e.test=function(u){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(u)}})(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(e,i,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:i,ctx:n||this}),this},EventEmitter.prototype.off=function(e,i){if(e===void 0)this._listeners={};else if(i===void 0)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===i?n.splice(r,1):++r;return this},EventEmitter.prototype.emit=function(e){var i=this._listeners[e];if(i){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<i.length;)i[r].fn.apply(i[r++].ctx,n)}return this};var float=factory(factory);function factory(t){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),i=new Uint8Array(e.buffer),n=i[3]===128;function r(l,a,f){e[0]=l,a[f]=i[0],a[f+1]=i[1],a[f+2]=i[2],a[f+3]=i[3]}function o(l,a,f){e[0]=l,a[f]=i[3],a[f+1]=i[2],a[f+2]=i[1],a[f+3]=i[0]}t.writeFloatLE=n?r:o,t.writeFloatBE=n?o:r;function s(l,a){return i[0]=l[a],i[1]=l[a+1],i[2]=l[a+2],i[3]=l[a+3],e[0]}function u(l,a){return i[3]=l[a],i[2]=l[a+1],i[1]=l[a+2],i[0]=l[a+3],e[0]}t.readFloatLE=n?s:u,t.readFloatBE=n?u:s}():function(){function e(n,r,o,s){var u=r<0?1:0;if(u&&(r=-r),r===0)n(1/r>0?0:2147483648,o,s);else if(isNaN(r))n(2143289344,o,s);else if(r>34028234663852886e22)n((u<<31|2139095040)>>>0,o,s);else if(r<11754943508222875e-54)n((u<<31|Math.round(r/1401298464324817e-60))>>>0,o,s);else{var l=Math.floor(Math.log(r)/Math.LN2),a=Math.round(r*Math.pow(2,-l)*8388608)&8388607;n((u<<31|l+127<<23|a)>>>0,o,s)}}t.writeFloatLE=e.bind(null,writeUintLE),t.writeFloatBE=e.bind(null,writeUintBE);function i(n,r,o){var s=n(r,o),u=(s>>31)*2+1,l=s>>>23&255,a=s&8388607;return l===255?a?NaN:u*(1/0):l===0?u*1401298464324817e-60*a:u*Math.pow(2,l-150)*(a+8388608)}t.readFloatLE=i.bind(null,readUintLE),t.readFloatBE=i.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),i=new Uint8Array(e.buffer),n=i[7]===128;function r(l,a,f){e[0]=l,a[f]=i[0],a[f+1]=i[1],a[f+2]=i[2],a[f+3]=i[3],a[f+4]=i[4],a[f+5]=i[5],a[f+6]=i[6],a[f+7]=i[7]}function o(l,a,f){e[0]=l,a[f]=i[7],a[f+1]=i[6],a[f+2]=i[5],a[f+3]=i[4],a[f+4]=i[3],a[f+5]=i[2],a[f+6]=i[1],a[f+7]=i[0]}t.writeDoubleLE=n?r:o,t.writeDoubleBE=n?o:r;function s(l,a){return i[0]=l[a],i[1]=l[a+1],i[2]=l[a+2],i[3]=l[a+3],i[4]=l[a+4],i[5]=l[a+5],i[6]=l[a+6],i[7]=l[a+7],e[0]}function u(l,a){return i[7]=l[a],i[6]=l[a+1],i[5]=l[a+2],i[4]=l[a+3],i[3]=l[a+4],i[2]=l[a+5],i[1]=l[a+6],i[0]=l[a+7],e[0]}t.readDoubleLE=n?s:u,t.readDoubleBE=n?u:s}():function(){function e(n,r,o,s,u,l){var a=s<0?1:0;if(a&&(s=-s),s===0)n(0,u,l+r),n(1/s>0?0:2147483648,u,l+o);else if(isNaN(s))n(0,u,l+r),n(2146959360,u,l+o);else if(s>17976931348623157e292)n(0,u,l+r),n((a<<31|2146435072)>>>0,u,l+o);else{var f;if(s<22250738585072014e-324)f=s/5e-324,n(f>>>0,u,l+r),n((a<<31|f/4294967296)>>>0,u,l+o);else{var h=Math.floor(Math.log(s)/Math.LN2);h===1024&&(h=1023),f=s*Math.pow(2,-h),n(f*4503599627370496>>>0,u,l+r),n((a<<31|h+1023<<20|f*1048576&1048575)>>>0,u,l+o)}}}t.writeDoubleLE=e.bind(null,writeUintLE,0,4),t.writeDoubleBE=e.bind(null,writeUintBE,4,0);function i(n,r,o,s,u){var l=n(s,u+r),a=n(s,u+o),f=(a>>31)*2+1,h=a>>>20&2047,d=4294967296*(a&1048575)+l;return h===2047?d?NaN:f*(1/0):h===0?f*5e-324*d:f*Math.pow(2,h-1075)*(d+4503599627370496)}t.readDoubleLE=i.bind(null,readUintLE,0,4),t.readDoubleBE=i.bind(null,readUintBE,4,0)}(),t}function writeUintLE(t,e,i){e[i]=t&255,e[i+1]=t>>>8&255,e[i+2]=t>>>16&255,e[i+3]=t>>>24}function writeUintBE(t,e,i){e[i]=t>>>24,e[i+1]=t>>>16&255,e[i+2]=t>>>8&255,e[i+3]=t&255}function readUintLE(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function readUintBE(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}var utf8$2={};(function(t){var e=t;e.length=function(n){for(var r=0,o=0,s=0;s<n.length;++s)o=n.charCodeAt(s),o<128?r+=1:o<2048?r+=2:(o&64512)===55296&&(n.charCodeAt(s+1)&64512)===56320?(++s,r+=4):r+=3;return r},e.read=function(n,r,o){var s=o-r;if(s<1)return"";for(var u=null,l=[],a=0,f;r<o;)f=n[r++],f<128?l[a++]=f:f>191&&f<224?l[a++]=(f&31)<<6|n[r++]&63:f>239&&f<365?(f=((f&7)<<18|(n[r++]&63)<<12|(n[r++]&63)<<6|n[r++]&63)-65536,l[a++]=55296+(f>>10),l[a++]=56320+(f&1023)):l[a++]=(f&15)<<12|(n[r++]&63)<<6|n[r++]&63,a>8191&&((u||(u=[])).push(String.fromCharCode.apply(String,l)),a=0);return u?(a&&u.push(String.fromCharCode.apply(String,l.slice(0,a))),u.join("")):String.fromCharCode.apply(String,l.slice(0,a))},e.write=function(n,r,o){for(var s=o,u,l,a=0;a<n.length;++a)u=n.charCodeAt(a),u<128?r[o++]=u:u<2048?(r[o++]=u>>6|192,r[o++]=u&63|128):(u&64512)===55296&&((l=n.charCodeAt(a+1))&64512)===56320?(u=65536+((u&1023)<<10)+(l&1023),++a,r[o++]=u>>18|240,r[o++]=u>>12&63|128,r[o++]=u>>6&63|128,r[o++]=u&63|128):(r[o++]=u>>12|224,r[o++]=u>>6&63|128,r[o++]=u&63|128);return o-s}})(utf8$2);var pool_1=pool;function pool(t,e,i){var n=i||8192,r=n>>>1,o=null,s=n;return function(l){if(l<1||l>r)return t(l);s+l>n&&(o=t(n),s=0);var a=e.call(o,s,s+=l);return s&7&&(s=(s|7)+1),a}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=e;var t=requireMinimal();function e(o,s){this.lo=o>>>0,this.hi=s>>>0}var i=e.zero=new e(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var n=e.zeroHash="\0\0\0\0\0\0\0\0";e.fromNumber=function(s){if(s===0)return i;var u=s<0;u&&(s=-s);var l=s>>>0,a=(s-l)/4294967296>>>0;return u&&(a=~a>>>0,l=~l>>>0,++l>4294967295&&(l=0,++a>4294967295&&(a=0))),new e(l,a)},e.from=function(s){if(typeof s=="number")return e.fromNumber(s);if(t.isString(s))if(t.Long)s=t.Long.fromString(s);else return e.fromNumber(parseInt(s,10));return s.low||s.high?new e(s.low>>>0,s.high>>>0):i},e.prototype.toNumber=function(s){if(!s&&this.hi>>>31){var u=~this.lo+1>>>0,l=~this.hi>>>0;return u||(l=l+1>>>0),-(u+l*4294967296)}return this.lo+this.hi*4294967296},e.prototype.toLong=function(s){return t.Long?new t.Long(this.lo|0,this.hi|0,!!s):{low:this.lo|0,high:this.hi|0,unsigned:!!s}};var r=String.prototype.charCodeAt;return e.fromHash=function(s){return s===n?i:new e((r.call(s,0)|r.call(s,1)<<8|r.call(s,2)<<16|r.call(s,3)<<24)>>>0,(r.call(s,4)|r.call(s,5)<<8|r.call(s,6)<<16|r.call(s,7)<<24)>>>0)},e.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},e.prototype.zzEncode=function(){var s=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^s)>>>0,this.lo=(this.lo<<1^s)>>>0,this},e.prototype.zzDecode=function(){var s=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^s)>>>0,this.hi=(this.hi>>>1^s)>>>0,this},e.prototype.length=function(){var s=this.lo,u=(this.lo>>>28|this.hi<<4)>>>0,l=this.hi>>>24;return l===0?u===0?s<16384?s<128?1:2:s<2097152?3:4:u<16384?u<128?5:6:u<2097152?7:8:l<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(t){var e=t;e.asPromise=aspromise,e.base64=base64$1,e.EventEmitter=eventemitter,e.float=float,e.inquire=inquire_1,e.utf8=utf8$2,e.pool=pool_1,e.LongBits=requireLongbits(),e.isNode=!!(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),e.global=e.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(o){return typeof o=="number"&&isFinite(o)&&Math.floor(o)===o},e.isString=function(o){return typeof o=="string"||o instanceof String},e.isObject=function(o){return o&&typeof o=="object"},e.isset=e.isSet=function(o,s){var u=o[s];return u!=null&&o.hasOwnProperty(s)?typeof u!="object"||(Array.isArray(u)?u.length:Object.keys(u).length)>0:!1},e.Buffer=function(){try{var r=e.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch{return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(o){return typeof o=="number"?e.Buffer?e._Buffer_allocUnsafe(o):new e.Array(o):e.Buffer?e._Buffer_from(o):typeof Uint8Array>"u"?o:new Uint8Array(o)},e.Array=typeof Uint8Array<"u"?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(o){return o?e.LongBits.from(o).toHash():e.LongBits.zeroHash},e.longFromHash=function(o,s){var u=e.LongBits.fromHash(o);return e.Long?e.Long.fromBits(u.lo,u.hi,s):u.toNumber(!!s)};function i(r,o,s){for(var u=Object.keys(o),l=0;l<u.length;++l)(r[u[l]]===void 0||!s)&&(r[u[l]]=o[u[l]]);return r}e.merge=i,e.lcFirst=function(o){return o.charAt(0).toLowerCase()+o.substring(1)};function n(r){function o(s,u){if(!(this instanceof o))return new o(s,u);Object.defineProperty(this,"message",{get:function(){return s}}),Error.captureStackTrace?Error.captureStackTrace(this,o):Object.defineProperty(this,"stack",{value:new Error().stack||""}),u&&i(this,u)}return o.prototype=Object.create(Error.prototype,{constructor:{value:o,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return r},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),o}e.newError=n,e.ProtocolError=n("ProtocolError"),e.oneOfGetter=function(o){for(var s={},u=0;u<o.length;++u)s[o[u]]=1;return function(){for(var l=Object.keys(this),a=l.length-1;a>-1;--a)if(s[l[a]]===1&&this[l[a]]!==void 0&&this[l[a]]!==null)return l[a]}},e.oneOfSetter=function(o){return function(s){for(var u=0;u<o.length;++u)o[u]!==s&&delete this[o[u]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var r=e.Buffer;if(!r){e._Buffer_from=e._Buffer_allocUnsafe=null;return}e._Buffer_from=r.from!==Uint8Array.from&&r.from||function(s,u){return new r(s,u)},e._Buffer_allocUnsafe=r.allocUnsafe||function(s){return new r(s)}}}(minimal$1)),minimal$1}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(t,e,i){this.fn=t,this.len=e,this.next=void 0,this.val=i}function noop(){}function State(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function t(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1(),Writer$1.alloc=function t(e){return new util$4.Array(e)},util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray)),Writer$1.prototype._push=function t(e,i,n){return this.tail=this.tail.next=new Op(e,i,n),this.len+=i,this};function writeByte(t,e,i){e[i]=t&255}function writeVarint32(t,e,i){for(;t>127;)e[i++]=t&127|128,t>>>=7;e[i]=t}function VarintOp(t,e){this.len=t,this.next=void 0,this.val=e}VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer$1.prototype.uint32=function t(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},Writer$1.prototype.int32=function t(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)},Writer$1.prototype.sint32=function t(e){return this.uint32((e<<1^e>>31)>>>0)};function writeVarint64(t,e,i){for(;t.hi;)e[i++]=t.lo&127|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[i++]=t.lo&127|128,t.lo=t.lo>>>7;e[i++]=t.lo}Writer$1.prototype.uint64=function t(e){var i=LongBits$1.from(e);return this._push(writeVarint64,i.length(),i)},Writer$1.prototype.int64=Writer$1.prototype.uint64,Writer$1.prototype.sint64=function t(e){var i=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,i.length(),i)},Writer$1.prototype.bool=function t(e){return this._push(writeByte,1,e?1:0)};function writeFixed32(t,e,i){e[i]=t&255,e[i+1]=t>>>8&255,e[i+2]=t>>>16&255,e[i+3]=t>>>24}Writer$1.prototype.fixed32=function t(e){return this._push(writeFixed32,4,e>>>0)},Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32,Writer$1.prototype.fixed64=function t(e){var i=LongBits$1.from(e);return this._push(writeFixed32,4,i.lo)._push(writeFixed32,4,i.hi)},Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64,Writer$1.prototype.float=function t(e){return this._push(util$4.float.writeFloatLE,4,e)},Writer$1.prototype.double=function t(e){return this._push(util$4.float.writeDoubleLE,8,e)};var writeBytes=util$4.Array.prototype.set?function t(e,i,n){i.set(e,n)}:function t(e,i,n){for(var r=0;r<e.length;++r)i[n+r]=e[r]};Writer$1.prototype.bytes=function t(e){var i=e.length>>>0;if(!i)return this._push(writeByte,1,0);if(util$4.isString(e)){var n=Writer$1.alloc(i=base64.length(e));base64.decode(e,n,0),e=n}return this.uint32(i)._push(writeBytes,i,e)},Writer$1.prototype.string=function t(e){var i=utf8$1.length(e);return i?this.uint32(i)._push(utf8$1.write,i,e):this._push(writeByte,1,0)},Writer$1.prototype.fork=function t(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer$1.prototype.reset=function t(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer$1.prototype.ldelim=function t(){var e=this.head,i=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=i,this.len+=n),this},Writer$1.prototype.finish=function t(){for(var e=this.head.next,i=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,i,n),n+=e.len,e=e.next;return i},Writer$1._configure=function(t){BufferWriter$1=t,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(e,i,n){i.set(e,n)}:function(e,i,n){if(e.copy)e.copy(i,n,0,e.length);else for(var r=0;r<e.length;)i[n++]=e[r++]}},BufferWriter.prototype.bytes=function t(e){util$3.isString(e)&&(e=util$3._Buffer_from(e,"base64"));var i=e.length>>>0;return this.uint32(i),i&&this._push(BufferWriter.writeBytesBuffer,i,e),this};function writeStringBuffer(t,e,i){t.length<40?util$3.utf8.write(t,e,i):e.utf8Write?e.utf8Write(t,i):e.write(t,i)}BufferWriter.prototype.string=function t(e){var i=util$3.Buffer.byteLength(e);return this.uint32(i),i&&this._push(writeStringBuffer,i,e),this},BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function Reader$1(t){this.buf=t,this.pos=0,this.len=t.length}var create_array=typeof Uint8Array<"u"?function t(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")}:function t(e){if(Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")},create=function t(){return util$2.Buffer?function(i){return(Reader$1.create=function(r){return util$2.Buffer.isBuffer(r)?new BufferReader$1(r):create_array(r)})(i)}:create_array};Reader$1.create=create(),Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice,Reader$1.prototype.uint32=function t(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return e}}(),Reader$1.prototype.int32=function t(){return this.uint32()|0},Reader$1.prototype.sint32=function t(){var e=this.uint32();return e>>>1^-(e&1)|0};function readLongVarint(){var t=new LongBits(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw indexOutOfRange(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,t}if(this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw indexOutOfRange(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function t(){return this.uint32()!==0};function readFixed32_end(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}Reader$1.prototype.fixed32=function t(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.sfixed32=function t(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function t(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Reader$1.prototype.double=function t(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Reader$1.prototype.bytes=function t(){var e=this.uint32(),i=this.pos,n=this.pos+e;if(n>this.len)throw indexOutOfRange(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(i,n);if(i===n){var r=util$2.Buffer;return r?r.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,i,n)},Reader$1.prototype.string=function t(){var e=this.bytes();return utf8.read(e,0,e.length)},Reader$1.prototype.skip=function t(e){if(typeof e=="number"){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this},Reader$1.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},Reader$1._configure=function(t){BufferReader$1=t,Reader$1.create=create(),BufferReader$1._configure();var e=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[e](!1)},uint64:function(){return readLongVarint.call(this)[e](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[e](!1)},fixed64:function(){return readFixed64.call(this)[e](!0)},sfixed64:function(){return readFixed64.call(this)[e](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(t){Reader.call(this,t)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)},BufferReader.prototype.string=function t(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(t,e,i){if(typeof t!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=!!e,this.responseDelimited=!!i}Service.prototype.rpcCall=function t(e,i,n,r,o){if(!r)throw TypeError("request must be specified");var s=this;if(!o)return util.asPromise(t,s,e,i,n,r);if(!s.rpcImpl){setTimeout(function(){o(Error("already ended"))},0);return}try{return s.rpcImpl(e,i[s.requestDelimited?"encodeDelimited":"encode"](r).finish(),function(l,a){if(l)return s.emit("error",l,e),o(l);if(a===null){s.end(!0);return}if(!(a instanceof n))try{a=n[s.responseDelimited?"decodeDelimited":"decode"](a)}catch(f){return s.emit("error",f,e),o(f)}return s.emit("data",a,e),o(null,a)})}catch(u){s.emit("error",u,e),setTimeout(function(){o(u)},0);return}},Service.prototype.end=function t(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},function(t){var e=t;e.Service=service}(rpc);var roots={};(function(t){var e=t;e.build="minimal",e.Writer=writer,e.BufferWriter=writer_buffer,e.Reader=reader,e.BufferReader=reader_buffer,e.util=requireMinimal(),e.rpc=rpc,e.roots=roots,e.configure=i;function i(){e.util._configure(),e.Writer._configure(e.BufferWriter),e.Reader._configure(e.BufferReader)}i()})(indexMinimal);var minimal=indexMinimal;const baseProfile={comment:0,defaultSampleType:0,dropFrames:0,durationNanos:0,keepFrames:0,period:0,stringTable:"",timeNanos:0},Profile={encode(t,e=minimal.Writer.create()){for(const i of t.sampleType)ValueType.encode(i,e.uint32(10).fork()).ldelim();for(const i of t.sample)Sample.encode(i,e.uint32(18).fork()).ldelim();for(const i of t.mapping)Mapping.encode(i,e.uint32(26).fork()).ldelim();for(const i of t.location)Location.encode(i,e.uint32(34).fork()).ldelim();for(const i of t.function)Function.encode(i,e.uint32(42).fork()).ldelim();for(const i of t.stringTable)e.uint32(50).string(i);t.dropFrames!==0&&e.uint32(56).int64(t.dropFrames),t.keepFrames!==0&&e.uint32(64).int64(t.keepFrames),t.timeNanos!==0&&e.uint32(72).int64(t.timeNanos),t.durationNanos!==0&&e.uint32(80).int64(t.durationNanos),t.periodType!==void 0&&ValueType.encode(t.periodType,e.uint32(90).fork()).ldelim(),t.period!==0&&e.uint32(96).int64(t.period),e.uint32(106).fork();for(const i of t.comment)e.int64(i);return e.ldelim(),t.defaultSampleType!==0&&e.uint32(112).int64(t.defaultSampleType),e},fromPartial(t){const e={...baseProfile};if(e.sampleType=[],e.sample=[],e.mapping=[],e.location=[],e.function=[],e.stringTable=[],e.comment=[],t.sampleType!==void 0&&t.sampleType!==null)for(const i of t.sampleType)e.sampleType.push(ValueType.fromPartial(i));if(t.sample!==void 0&&t.sample!==null)for(const i of t.sample)e.sample.push(Sample.fromPartial(i));if(t.mapping!==void 0&&t.mapping!==null)for(const i of t.mapping)e.mapping.push(Mapping.fromPartial(i));if(t.location!==void 0&&t.location!==null)for(const i of t.location)e.location.push(Location.fromPartial(i));if(t.function!==void 0&&t.function!==null)for(const i of t.function)e.function.push(Function.fromPartial(i));if(t.stringTable!==void 0&&t.stringTable!==null)for(const i of t.stringTable)e.stringTable.push(i);if(t.dropFrames!==void 0&&t.dropFrames!==null?e.dropFrames=t.dropFrames:e.dropFrames=0,t.keepFrames!==void 0&&t.keepFrames!==null?e.keepFrames=t.keepFrames:e.keepFrames=0,t.timeNanos!==void 0&&t.timeNanos!==null?e.timeNanos=t.timeNanos:e.timeNanos=0,t.durationNanos!==void 0&&t.durationNanos!==null?e.durationNanos=t.durationNanos:e.durationNanos=0,t.periodType!==void 0&&t.periodType!==null?e.periodType=ValueType.fromPartial(t.periodType):e.periodType=void 0,t.period!==void 0&&t.period!==null?e.period=t.period:e.period=0,t.comment!==void 0&&t.comment!==null)for(const i of t.comment)e.comment.push(i);return t.defaultSampleType!==void 0&&t.defaultSampleType!==null?e.defaultSampleType=t.defaultSampleType:e.defaultSampleType=0,e}},baseValueType={type:0,unit:0},ValueType={encode(t,e=minimal.Writer.create()){return t.type!==0&&e.uint32(8).int64(t.type),t.unit!==0&&e.uint32(16).int64(t.unit),e},fromPartial(t){const e={...baseValueType};return t.type!==void 0&&t.type!==null?e.type=t.type:e.type=0,t.unit!==void 0&&t.unit!==null?e.unit=t.unit:e.unit=0,e}},baseSample={locationId:0,value:0},Sample={encode(t,e=minimal.Writer.create()){e.uint32(10).fork();for(const i of t.locationId)e.uint64(i);e.ldelim(),e.uint32(18).fork();for(const i of t.value)e.int64(i);e.ldelim();for(const i of t.label)Label.encode(i,e.uint32(26).fork()).ldelim();return e},fromPartial(t){const e={...baseSample};if(e.locationId=[],e.value=[],e.label=[],t.locationId!==void 0&&t.locationId!==null)for(const i of t.locationId)e.locationId.push(i);if(t.value!==void 0&&t.value!==null)for(const i of t.value)e.value.push(i);if(t.label!==void 0&&t.label!==null)for(const i of t.label)e.label.push(Label.fromPartial(i));return e}},baseLabel={key:0,num:0,numUnit:0,str:0},Label={encode(t,e=minimal.Writer.create()){return t.key!==0&&e.uint32(8).int64(t.key),t.str!==0&&e.uint32(16).int64(t.str),t.num!==0&&e.uint32(24).int64(t.num),t.numUnit!==0&&e.uint32(32).int64(t.numUnit),e},fromPartial(t){const e={...baseLabel};return t.key!==void 0&&t.key!==null?e.key=t.key:e.key=0,t.str!==void 0&&t.str!==null?e.str=t.str:e.str=0,t.num!==void 0&&t.num!==null?e.num=t.num:e.num=0,t.numUnit!==void 0&&t.numUnit!==null?e.numUnit=t.numUnit:e.numUnit=0,e}},baseMapping={buildId:0,fileOffset:0,filename:0,hasFilenames:!1,hasFunctions:!1,hasInlineFrames:!1,hasLineNumbers:!1,id:0,memoryLimit:0,memoryStart:0},Mapping={encode(t,e=minimal.Writer.create()){return t.id!==0&&e.uint32(8).uint64(t.id),t.memoryStart!==0&&e.uint32(16).uint64(t.memoryStart),t.memoryLimit!==0&&e.uint32(24).uint64(t.memoryLimit),t.fileOffset!==0&&e.uint32(32).uint64(t.fileOffset),t.filename!==0&&e.uint32(40).int64(t.filename),t.buildId!==0&&e.uint32(48).int64(t.buildId),t.hasFunctions===!0&&e.uint32(56).bool(t.hasFunctions),t.hasFilenames===!0&&e.uint32(64).bool(t.hasFilenames),t.hasLineNumbers===!0&&e.uint32(72).bool(t.hasLineNumbers),t.hasInlineFrames===!0&&e.uint32(80).bool(t.hasInlineFrames),e},fromPartial(t){const e={...baseMapping};return t.id!==void 0&&t.id!==null?e.id=t.id:e.id=0,t.memoryStart!==void 0&&t.memoryStart!==null?e.memoryStart=t.memoryStart:e.memoryStart=0,t.memoryLimit!==void 0&&t.memoryLimit!==null?e.memoryLimit=t.memoryLimit:e.memoryLimit=0,t.fileOffset!==void 0&&t.fileOffset!==null?e.fileOffset=t.fileOffset:e.fileOffset=0,t.filename!==void 0&&t.filename!==null?e.filename=t.filename:e.filename=0,t.buildId!==void 0&&t.buildId!==null?e.buildId=t.buildId:e.buildId=0,t.hasFunctions!==void 0&&t.hasFunctions!==null?e.hasFunctions=t.hasFunctions:e.hasFunctions=!1,t.hasFilenames!==void 0&&t.hasFilenames!==null?e.hasFilenames=t.hasFilenames:e.hasFilenames=!1,t.hasLineNumbers!==void 0&&t.hasLineNumbers!==null?e.hasLineNumbers=t.hasLineNumbers:e.hasLineNumbers=!1,t.hasInlineFrames!==void 0&&t.hasInlineFrames!==null?e.hasInlineFrames=t.hasInlineFrames:e.hasInlineFrames=!1,e}},baseLocation={address:0,id:0,isFolded:!1,mappingId:0},Location={encode(t,e=minimal.Writer.create()){t.id!==0&&e.uint32(8).uint64(t.id),t.mappingId!==0&&e.uint32(16).uint64(t.mappingId),t.address!==0&&e.uint32(24).uint64(t.address);for(const i of t.line)Line.encode(i,e.uint32(34).fork()).ldelim();return t.isFolded===!0&&e.uint32(40).bool(t.isFolded),e},fromPartial(t){const e={...baseLocation};if(e.line=[],t.id!==void 0&&t.id!==null?e.id=t.id:e.id=0,t.mappingId!==void 0&&t.mappingId!==null?e.mappingId=t.mappingId:e.mappingId=0,t.address!==void 0&&t.address!==null?e.address=t.address:e.address=0,t.line!==void 0&&t.line!==null)for(const i of t.line)e.line.push(Line.fromPartial(i));return t.isFolded!==void 0&&t.isFolded!==null?e.isFolded=t.isFolded:e.isFolded=!1,e}},baseLine={functionId:0,line:0},Line={encode(t,e=minimal.Writer.create()){return t.functionId!==0&&e.uint32(8).uint64(t.functionId),(typeof t.line=="number"&&t.line!==0||typeof t.line!="number"&&(t.line.low!==0||t.line.high!==0))&&e.uint32(16).int64(t.line),e},fromPartial(t){const e={...baseLine};return t.functionId!==void 0&&t.functionId!==null?e.functionId=t.functionId:e.functionId=0,t.line!==void 0&&t.line!==null?e.line=t.line:e.line=0,e}},baseFunction={filename:0,id:0,name:0,startLine:0,systemName:0},Function={encode(t,e=minimal.Writer.create()){return t.id!==0&&e.uint32(8).uint64(t.id),t.name!==0&&e.uint32(16).int64(t.name),t.systemName!==0&&e.uint32(24).int64(t.systemName),t.filename!==0&&e.uint32(32).int64(t.filename),t.startLine!==0&&e.uint32(40).int64(t.startLine),e},fromPartial(t){const e={...baseFunction};return t.id!==void 0&&t.id!==null?e.id=t.id:e.id=0,t.name!==void 0&&t.name!==null?e.name=t.name:e.name=0,t.systemName!==void 0&&t.systemName!==null?e.systemName=t.systemName:e.systemName=0,t.filename!==void 0&&t.filename!==null?e.filename=t.filename:e.filename=0,t.startLine!==void 0&&t.startLine!==null?e.startLine=t.startLine:e.startLine=0,e}},ANONYMOUS_FUNCTION="(anonymous)",exportToPprofIntake=(t,e)=>{const i=buildPprof(t),n=extractAttributes(t,e);return sendPprof(new Date(t.timeOrigin+t.startTime),new Date(t.timeOrigin+t.endTime),i,e,n)};function buildPprof(t){const e=new StringsTable,i=[],n=[],r=[],o=new SamplesView(t),s=new LongTasksTimeline(t),u=new MeasuresTimeline(t),l=new EventsTimeline(t),a=new InteractionsTimeline(t),f=new NavigationTimeline(t);for(let p=0;p<t.frames.length;p++){const c=t.frames[p],R=c.resourceId!==void 0?e.dedup(t.resources[c.resourceId]):0,v=e.dedup(c.name||ANONYMOUS_FUNCTION),L=v;let g=i.findIndex(E=>E.filename===R&&E.name===v&&E.systemName===L);g===-1&&(g=i.length,i.push(Function.fromPartial({id:i.length+1,filename:R,name:v,systemName:L}))),n.push(Location.fromPartial({id:n.length+1,line:[Line.fromPartial({functionId:i[g].id,line:{high:c.column||0,low:c.line||0,unsigned:!0}})]}))}if(t.samples.length)for(let p=0;p<t.samples.length;p++){const c=t.samples[p],R=[];let v=c.stackId;for(;v!==void 0;){const{frameId:m,parentId:b}=t.stacks[v];R.push(n[m].id),v=b}if(R.length===0)continue;const L=o.getStartTime(p),g=o.getMiddleTime(p),E=o.getEndTime(p),T=s.get(g),O=u.get(g),$=l.get(g),k=a.get(g),x=f.get(g),y=[];if(T.length>0)for(const m of T)y.push(Label.fromPartial({key:e.dedup("task"),str:e.dedup(`Long Task (${getLongTaskId(m)})`)}));else y.push(Label.fromPartial({key:e.dedup("task"),str:e.dedup("Short Tasks")}));for(const m of O)y.push(Label.fromPartial({key:e.dedup("measure"),str:e.dedup(m.name)}));for(const m of $)y.push(Label.fromPartial({key:e.dedup("event"),str:e.dedup(`${m.name} (${Math.round(m.startTime)})`)}));for(const m of k)y.push(Label.fromPartial({key:e.dedup("interaction"),str:e.dedup(`${m.interactionId}`)}));for(const m of x)y.push(Label.fromPartial({key:e.dedup("trace endpoint"),str:e.dedup(m.name)}));y.push(Label.fromPartial({key:e.dedup("end_timestamp_ns"),num:(t.timeOrigin+E)*1e6}));const B=(E-L)*1e6,S=T.length?B:0,I=1;r.push(Sample.fromPartial({locationId:R,value:[B,S,I],label:y}))}const h=[ValueType.fromPartial({type:e.dedup("wall-time"),unit:e.dedup("nanoseconds")}),ValueType.fromPartial({type:e.dedup("long-task-time"),unit:e.dedup("nanoseconds")}),ValueType.fromPartial({type:e.dedup("sample"),unit:e.dedup("count")})],d=ValueType.fromPartial({type:e.dedup("wall-time"),unit:e.dedup("nanoseconds")}),_=Profile.fromPartial({sampleType:h,defaultSampleType:0,periodType:d,period:t.sampleInterval*1e6,durationNanos:(t.endTime-t.startTime)*1e6,timeNanos:(t.timeOrigin+t.startTime)*1e6,function:i,location:n,sample:r,stringTable:Array.from(e)});return new Blob([Profile.encode(_).finish()],{type:"application/octet-stream"})}function extractAttributes(t,e){var s,u;const i={application:{id:e.applicationId}},n=(u=(s=getRum())==null?void 0:s.getInternalContext())==null?void 0:u.session_id;n&&(i.session={id:n});const r=Array.from(new Set(t.navigation.map(l=>l.name)));r.length&&(i.view={name:r});const o=t.longTasks.map(l=>getLongTaskId(l));return o.length&&(i.context={profile_long_task_id:o}),i}function sendPprof(t,e,i,n,r={}){const o=[`service:${n.service}`,`version:${n.version}`,`env:${n.env||"unknown"}`,`application_id:${n.applicationId}`,"language:javascript","runtime:chrome","family:chrome","format:pprof",`host:${navigator.userAgent.replace(/[^a-zA-Z0-9_\-:./]/g,"_").replace(/__/g,"_").toLowerCase().slice(0,200)}`];n.commitHash&&o.push(`git.commit.sha:${n.commitHash}`),n.repositoryUrl&&o.push(`git.repository_url:${n.repositoryUrl}`);const s={...r,attachments:["wall-time.pprof"],start:t.toISOString(),end:e.toISOString(),family:"chrome",tags_profiler:o.join(",")},u=new FormData;u.append("event",new Blob([JSON.stringify(s)],{type:"application/json"}),"event.json"),u.append("wall-time.pprof",i,"wall-time.pprof");const l=f=>buildEndpoint(n.site,n.clientToken,"profile",[],f);return navigator.sendBeacon(l("beacon"),u)?Promise.resolve():fetch(l("fetch"),{method:"POST",body:u}).then(()=>{})}function getNumberOfSamples(t){let e=0;for(const i of t)i.stackId!==void 0&&e++;return e}const window_Profiler=window.Profiler,window_navigation=window.navigation,SAMPLE_INTERVAL_MS=10,COLLECT_INTERVAL_MS=6e4,MIN_PROFILE_DURATION_MS=5e3,MIN_NUMBER_OF_SAMPLES=50;class RumProfiler{constructor(e){this.config=e,this.session={state:"stopped"},this.startNextProfilerSession=()=>{if(!window_Profiler)throw new Error("RUM Profiler is not supported in this browser.");this.collectProfilerSession(),this.session={state:"running",startTime:performance.now(),profiler:new window_Profiler({sampleInterval:SAMPLE_INTERVAL_MS,maxBufferSize:Math.round(COLLECT_INTERVAL_MS*1.5/SAMPLE_INTERVAL_MS)}),timeoutId:setTimeout(this.startNextProfilerSession,COLLECT_INTERVAL_MS),longTasks:[],measures:[],events:[],navigation:[]},this.session.profiler.addEventListener("samplebufferfull",this.handleSampleBufferFull)},this.collectProfilerSession=()=>{if(this.session.state!=="running")return Promise.resolve();this.handleEntries(this.observer.takeRecords()),this.collectNavigationEntry();const{startTime:i,longTasks:n,measures:r,events:o,navigation:s}=this.session,u=this.session.profiler.stop().then(l=>{const a=performance.now();if(!(a-i<MIN_PROFILE_DURATION_MS)&&!(getNumberOfSamples(l.samples)<MIN_NUMBER_OF_SAMPLES))return this.handleProfilerTrace(Object.assign(l,{startTime:i,endTime:a,timeOrigin:performance.timeOrigin,longTasks:n,measures:r,events:o,navigation:s,sampleInterval:SAMPLE_INTERVAL_MS}))});return clearTimeout(this.session.timeoutId),this.session.profiler.removeEventListener("samplebufferfull",this.handleSampleBufferFull),u},this.stopProfilerSession=i=>{if(this.session.state!=="running")return Promise.resolve();const n=this.collectProfilerSession();return this.session={state:i},n},this.collectNavigationEntry=()=>{var n,r,o;if(this.session.state!=="running")return;const i=this.session;i.navigation.push({startTime:i.navigation.length?i.navigation[i.navigation.length-1].endTime:0,endTime:performance.now(),name:((o=(r=(n=getRum())==null?void 0:n.getInternalContext())==null?void 0:r.view)==null?void 0:o.name)||document.location.pathname})},this.handleProfilerTrace=i=>{performance.mark("rum.profiler.export_time_ms.start");const n=exportToPprofIntake(i,this.config);return performance.mark("rum.profiler.export_time_ms.end"),performance.measure("rum.profiler.export_time_ms","rum.profiler.export_time_ms.start","rum.profiler.export_time_ms.end"),n},this.handleSampleBufferFull=()=>{this.startNextProfilerSession()},this.handlePerformance=i=>{this.handleEntries(i.getEntries())},this.handleEntries=i=>{if(this.session.state==="running"){for(const n of i)if(!(n.duration<SAMPLE_INTERVAL_MS))switch(n.entryType){case"longtask":this.session.longTasks.push(n);break;case"measure":this.session.measures.push(n);break;case"event":this.session.events.push(n);break}}},this.handleNavigate=()=>{this.collectNavigationEntry()},this.handleVisibilityChange=()=>{document.visibilityState==="hidden"&&this.session.state==="running"?this.stopProfilerSession("paused"):document.visibilityState==="visible"&&this.session.state==="paused"&&this.startNextProfilerSession()},this.handleBeforeUnload=()=>{this.stopProfilerSession("stopped")},this.observer=new PerformanceObserver(this.handlePerformance)}get supported(){return window_Profiler!==void 0}start(){this.session.state!=="running"&&(this.observer.observe({entryTypes:["longtask","measure","event"]}),window.addEventListener("visibilitychange",this.handleVisibilityChange),window.addEventListener("beforeunload",this.handleBeforeUnload),window_navigation&&window_navigation.addEventListener("navigate",this.handleNavigate),this.startNextProfilerSession())}stop(){const e=this.stopProfilerSession("stopped");return this.observer.disconnect(),window.removeEventListener("visibilitychange",this.handleVisibilityChange),window.removeEventListener("beforeunload",this.handleBeforeUnload),window_navigation&&window_navigation.removeEventListener("navigate",this.handleNavigate),e}}function shouldSample(t){return t>=100?!0:t<=0?!1:Math.random()<=t/100}const DEFAULT_INTAKE="datadoghq.com",DEFAULT_PROFILING_SAMPLE_RATE=100;function initRumProfiler({applicationId:t,clientToken:e,service:i,version:n,env:r,site:o=DEFAULT_INTAKE,profilingSampleRate:s=DEFAULT_PROFILING_SAMPLE_RATE,commitHash:u,repositoryUrl:l}){if(shouldSample(s)){const a=new RumProfiler({applicationId:t,clientToken:e,service:i,version:n,env:r,site:o,commitHash:u,repositoryUrl:l});return a.start(),()=>a.stop()}return()=>Promise.resolve()}function beforeSend(t,e){return t.type==="long_task"&&(t.context||(t.context={}),t.context.profile_long_task_id=getLongTaskId(e.performanceEntry)),!0}exports.beforeSend=beforeSend,exports.initRumProfiler=initRumProfiler,Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})});
